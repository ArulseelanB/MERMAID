#!/bin/bash
#
# This will cause jest to restore its check that ES modules can only
# be loaded if its "package.json" has its type set to "module".
#
# This is used to revert the change made by "bypassEsmChecks"
# restoring the original *experimental* jest support for checking ES modules.
# 
# Only tested with "jest-resolve" version 28.1.3.

shouldLoadAsEsm="node_modules/jest-resolve/build/shouldLoadAsEsm.js"
line_number=87 # the source at line 71 ends up being at line 87 when distributed.

# The "-i ''" is required for inplace subsitutions on the standard macOS bash.
# Try just "-i" if you are on another bash and get an error.
sed -i "''" "${line_number}s/return false/return cachedLookup/" ${shouldLoadAsEsm}
